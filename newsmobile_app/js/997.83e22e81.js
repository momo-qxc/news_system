"use strict";(self["webpackChunknewsmobile"]=self["webpackChunknewsmobile"]||[]).push([[997],{5997:function(t,e,o){o.r(e),o.d(e,{default:function(){return h}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"my-container"},[e("van-nav-bar",{staticClass:"nav-header",attrs:{title:"我的"}}),t.isLoggedIn?e("div",{staticClass:"user-section"},[e("div",{staticClass:"user-card"},[e("div",{staticClass:"user-avatar"},[e("van-icon",{attrs:{name:"user-circle-o",size:"60",color:"#e60012"}})],1),e("div",{staticClass:"user-info"},[e("div",{staticClass:"user-phone"},[t._v(t._s(t.phone))]),e("div",{staticClass:"user-tag"},[t._v("普通用户")])])])]):e("div",{staticClass:"login-section"},[e("div",{staticClass:"avatar-placeholder"},[e("van-icon",{attrs:{name:"user-o",size:"60",color:"#ddd"}})],1),e("p",{staticClass:"login-hint"},[t._v("登录后享受更多功能")]),e("div",{staticClass:"login-buttons"},[e("van-button",{attrs:{type:"primary",round:"",block:""},on:{click:function(e){t.showLoginPopup=!0}}},[t._v(" 手机号登录 ")]),e("van-button",{staticClass:"register-btn",attrs:{plain:"",round:"",block:""},on:{click:function(e){t.showRegisterPopup=!0}}},[t._v(" 立即注册 ")])],1)]),e("div",{staticClass:"menu-section"},[e("van-cell-group",{attrs:{inset:""}},[e("van-cell",{attrs:{title:"我的收藏",icon:"star-o","is-link":"",value:t.isLoggedIn?t.collectionCount+"篇":""},on:{click:function(e){return t.goToList("collection")}}}),e("van-cell",{attrs:{title:"我的点赞",icon:"good-job-o","is-link":"",value:t.isLoggedIn?t.likeCount+"篇":""},on:{click:function(e){return t.goToList("like")}}}),e("van-cell",{attrs:{title:"浏览记录",icon:"clock-o","is-link":"",value:t.isLoggedIn?t.historyCount+"篇":""},on:{click:function(e){return t.goToList("history")}}})],1),e("van-cell-group",{staticClass:"mt-16",attrs:{inset:""}},[e("van-cell",{attrs:{title:"清除缓存",icon:"delete-o","is-link":""},on:{click:t.clearCache}}),e("van-cell",{attrs:{title:"关于我们",icon:"info-o","is-link":""},on:{click:function(e){t.showAbout=!0}}})],1),t.isLoggedIn?e("van-cell-group",{staticClass:"mt-16",attrs:{inset:""}},[e("van-cell",[e("van-button",{attrs:{type:"danger",plain:"",block:"",round:""},on:{click:t.logout}},[t._v(" 退出登录 ")])],1)],1):t._e()],1),e("van-popup",{style:{height:"50%"},attrs:{round:"",position:"bottom"},model:{value:t.showLoginPopup,callback:function(e){t.showLoginPopup=e},expression:"showLoginPopup"}},[e("div",{staticClass:"popup-content"},[e("h3",{staticClass:"popup-title"},[t._v("手机号登录")]),e("van-form",{on:{submit:t.onLogin}},[e("van-field",{attrs:{type:"tel",label:"手机号",placeholder:"请输入手机号",maxlength:"11",rules:[{required:!0,message:"请输入手机号"}]},model:{value:t.loginForm.phone,callback:function(e){t.$set(t.loginForm,"phone",e)},expression:"loginForm.phone"}}),e("van-field",{attrs:{type:"number",label:"验证码",placeholder:"请输入验证码",maxlength:"6",rules:[{required:!0,message:"请输入验证码"}]},scopedSlots:t._u([{key:"button",fn:function(){return[e("van-button",{attrs:{size:"small",type:"primary",disabled:t.countdown>0},on:{click:function(e){return e.preventDefault(),t.sendCode("login")}}},[t._v(" "+t._s(t.countdown>0?t.countdown+"s":"获取验证码")+" ")])]},proxy:!0}]),model:{value:t.loginForm.code,callback:function(e){t.$set(t.loginForm,"code",e)},expression:"loginForm.code"}}),e("div",{staticClass:"form-actions"},[e("van-button",{attrs:{type:"primary",block:"",round:"","native-type":"submit"}},[t._v(" 登 录 ")])],1)],1)],1)]),e("van-popup",{style:{height:"55%"},attrs:{round:"",position:"bottom"},model:{value:t.showRegisterPopup,callback:function(e){t.showRegisterPopup=e},expression:"showRegisterPopup"}},[e("div",{staticClass:"popup-content"},[e("h3",{staticClass:"popup-title"},[t._v("用户注册")]),e("van-form",{on:{submit:t.onRegister}},[e("van-field",{attrs:{label:"用户名",placeholder:"请输入用户名",rules:[{required:!0,message:"请输入用户名"}]},model:{value:t.registerForm.username,callback:function(e){t.$set(t.registerForm,"username",e)},expression:"registerForm.username"}}),e("van-field",{attrs:{type:"tel",label:"手机号",placeholder:"请输入手机号",maxlength:"11",rules:[{required:!0,message:"请输入手机号"}]},model:{value:t.registerForm.phone,callback:function(e){t.$set(t.registerForm,"phone",e)},expression:"registerForm.phone"}}),e("van-field",{attrs:{type:"number",label:"验证码",placeholder:"请输入验证码",maxlength:"6",rules:[{required:!0,message:"请输入验证码"}]},scopedSlots:t._u([{key:"button",fn:function(){return[e("van-button",{attrs:{size:"small",type:"primary",disabled:t.countdown>0},on:{click:function(e){return e.preventDefault(),t.sendCode("register")}}},[t._v(" "+t._s(t.countdown>0?t.countdown+"s":"获取验证码")+" ")])]},proxy:!0}]),model:{value:t.registerForm.code,callback:function(e){t.$set(t.registerForm,"code",e)},expression:"registerForm.code"}}),e("van-field",{attrs:{name:"sex",label:"性别"},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.registerForm.sex,callback:function(e){t.$set(t.registerForm,"sex",e)},expression:"registerForm.sex"}},[e("van-radio",{attrs:{name:1}},[t._v("男")]),e("van-radio",{attrs:{name:0}},[t._v("女")])],1)]},proxy:!0}])}),e("van-field",{attrs:{type:"number",label:"年龄",placeholder:"请输入年龄"},model:{value:t.registerForm.age,callback:function(e){t.$set(t.registerForm,"age",e)},expression:"registerForm.age"}}),e("div",{staticClass:"form-actions"},[e("van-button",{attrs:{type:"primary",block:"",round:"","native-type":"submit"}},[t._v(" 注 册 ")])],1)],1)],1)]),e("van-popup",{style:{width:"100%",height:"100%"},attrs:{position:"right"},model:{value:t.showListPopup,callback:function(e){t.showListPopup=e},expression:"showListPopup"}},[e("div",{staticClass:"list-page"},[e("van-nav-bar",{staticClass:"nav-header",attrs:{title:t.listTitle,"left-arrow":""},on:{"click-left":function(e){t.showListPopup=!1}},scopedSlots:t._u(["history"===t.listType?{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"delete-o",size:"18"},on:{click:t.clearAllHistory}})]},proxy:!0}:null],null,!0)}),e("div",{staticClass:"list-content"},[e("van-list",{attrs:{finished:t.listFinished,"finished-text":"没有更多了"},on:{load:t.loadListData},model:{value:t.listLoading,callback:function(e){t.listLoading=e},expression:"listLoading"}},t._l(t.listData,function(o){return e("van-swipe-cell",{key:o.nid||o.hid||o.lid||o.colid,scopedSlots:t._u([{key:"right",fn:function(){return[e("van-button",{staticClass:"delete-btn",attrs:{square:"",type:"danger",text:"删除"},on:{click:function(e){return t.deleteItem(o)}}})]},proxy:!0}],null,!0)},[e("van-cell",{attrs:{title:o.ntitle,label:o.createdate,"is-link":""},on:{click:function(e){return t.goToNews(o.nid)}}})],1)}),1),t.listLoading||0!==t.listData.length?t._e():e("van-empty",{attrs:{description:"暂无数据"}})],1)],1)]),e("van-popup",{style:{padding:"24px",width:"80%"},attrs:{round:""},model:{value:t.showAbout,callback:function(e){t.showAbout=e},expression:"showAbout"}},[e("div",{staticClass:"about-content"},[e("h3",[t._v("新闻聚合 App")]),e("p",[t._v("版本：1.0.0")]),e("p",[t._v("一款简洁好用的新闻阅读应用")]),e("van-button",{attrs:{type:"primary",block:"",round:"",size:"small"},on:{click:function(e){t.showAbout=!1}}},[t._v(" 知道了 ")])],1)]),e("van-tabbar",{attrs:{"active-color":"#e60012",route:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[e("van-tabbar-item",{attrs:{icon:"home-o",to:"/"}},[t._v("首页")]),e("van-tabbar-item",{attrs:{icon:"location-o",to:"/life"}},[t._v("生活")]),e("van-tabbar-item",{attrs:{icon:"guide-o",to:"/traffic"}},[t._v("交通")]),e("van-tabbar-item",{attrs:{icon:"user-o",to:"/my"}},[t._v("我的")])],1)],1)},i=[],n=(o(4114),o(8111),o(2489),o(8335),o(4603),o(7566),o(8721),o(4373)),a={name:"MyView",data(){return{active:3,showLoginPopup:!1,showRegisterPopup:!1,showListPopup:!1,showAbout:!1,countdown:0,countdownTimer:null,loginForm:{phone:"",code:""},registerForm:{username:"",phone:"",code:"",sex:1,age:""},collectionCount:0,likeCount:0,historyCount:0,listType:"",listTitle:"",listData:[],listLoading:!1,listFinished:!1,listPage:1,currentPhone:sessionStorage.getItem("cuser")||""}},computed:{isLoggedIn(){return!!this.currentPhone},phone(){return this.currentPhone}},mounted(){this.isLoggedIn&&this.loadCounts()},methods:{async loadCounts(){try{const t=await n.A.get(`http://localhost:6060/news/collection/getdetail?phone=${this.phone}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),this.collectionCount=e?e.length:0;const o=await n.A.get(`http://localhost:6060/news/like/getbyphone?phone=${this.phone}`);let s=o.data;"string"===typeof s&&(s=JSON.parse(s)),this.likeCount=s?s.length:0;const i=await n.A.get(`http://localhost:6060/news/history/getdetail?phone=${this.phone}`);let a=i.data;"string"===typeof a&&(a=JSON.parse(a)),this.historyCount=a?a.length:0}catch(t){console.error("Load counts error:",t)}},async sendCode(t){const e="login"===t?this.loginForm.phone:this.registerForm.phone;if(e&&11===e.length)try{await n.A.get(`http://localhost:6060/news/users/getcode?phone=${e}`),this.$toast.success("验证码已发送"),this.startCountdown()}catch(o){console.error("Send code error:",o),this.$toast.fail("发送失败")}else this.$toast("请输入正确的手机号")},startCountdown(){this.countdown=60,this.countdownTimer=setInterval(()=>{this.countdown--,this.countdown<=0&&clearInterval(this.countdownTimer)},1e3)},async onLogin(){try{const t=new URLSearchParams;t.append("phone",this.loginForm.phone),t.append("code",this.loginForm.code);const e=await n.A.post("http://localhost:6060/news/users/login",t);let o=e.data;console.log("Login response:",o,typeof o),!0===o||"true"===o||"TRUE"===o?(sessionStorage.setItem("cuser",this.loginForm.phone),this.currentPhone=this.loginForm.phone,this.$toast.success("登录成功"),this.showLoginPopup=!1,this.loginForm={phone:"",code:""},this.loadCounts()):this.$toast.fail("登录失败，请检查验证码")}catch(t){console.error("Login error:",t),this.$toast.fail("登录失败")}},async onRegister(){try{const t=new URLSearchParams;t.append("username",this.registerForm.username),t.append("phone",this.registerForm.phone),t.append("code",this.registerForm.code),t.append("sex",this.registerForm.sex),this.registerForm.age&&t.append("age",this.registerForm.age);const e=await n.A.post("http://localhost:6060/news/users/add",t);let o=e.data;if(console.log("Register response:",o),!0===o||"true"===o||"TRUE"===o||"success"===o||o>0){this.$toast.success("注册成功，请登录"),this.showRegisterPopup=!1;const t=this.registerForm.phone;this.registerForm={username:"",phone:"",code:"",sex:1,age:""},this.showLoginPopup=!0,this.loginForm.phone=t}else this.$toast.fail("注册失败")}catch(t){console.error("Register error:",t),this.$toast.fail("注册失败")}},logout(){this.$dialog.confirm({title:"提示",message:"确定要退出登录吗？"}).then(()=>{sessionStorage.removeItem("cuser"),this.currentPhone="",this.collectionCount=0,this.likeCount=0,this.historyCount=0,this.$toast.success("已退出登录")}).catch(()=>{})},goToList(t){this.isLoggedIn?(this.listType=t,this.listTitle="collection"===t?"我的收藏":"like"===t?"我的点赞":"浏览记录",this.listData=[],this.listPage=1,this.listFinished=!1,this.showListPopup=!0):this.$toast("请先登录")},async loadListData(){try{let t="";t="collection"===this.listType?`http://localhost:6060/news/collection/getdetail?phone=${this.phone}`:"like"===this.listType?`http://localhost:6060/news/like/getbyphone?phone=${this.phone}`:`http://localhost:6060/news/history/getdetail?phone=${this.phone}`;const e=await n.A.get(t);let o=e.data;"string"===typeof o&&(o=JSON.parse(o)),o&&o.length>0&&(this.listData=o),this.listFinished=!0,this.listLoading=!1}catch(t){console.error("Load list error:",t),this.listLoading=!1,this.listFinished=!0}},goToNews(t){this.showListPopup=!1,this.$router.push({name:"newsDetail",params:{nid:t}})},async deleteItem(t){try{await this.$dialog.confirm({title:"提示",message:"确定要删除这条记录吗？"});let e="";if("collection"===this.listType)e=`http://localhost:6060/news/collection/del/${t.colid}`;else{if("like"===this.listType)return e=`http://localhost:6060/news/like/toggle?phone=${this.phone}&nid=${t.nid}`,await n.A.post(e),this.$toast.success("已删除"),this.listData=this.listData.filter(e=>e.lid!==t.lid),void(this.likeCount=Math.max(0,this.likeCount-1));e=`http://localhost:6060/news/history/del/${t.hid}`}await n.A.delete(e),this.$toast.success("已删除"),"collection"===this.listType?(this.listData=this.listData.filter(e=>e.colid!==t.colid),this.collectionCount=Math.max(0,this.collectionCount-1)):(this.listData=this.listData.filter(e=>e.hid!==t.hid),this.historyCount=Math.max(0,this.historyCount-1))}catch(e){"cancel"!==e&&(console.error("Delete error:",e),this.$toast.fail("删除失败"))}},async clearAllHistory(){try{await this.$dialog.confirm({title:"提示",message:"确定要清空所有浏览记录吗？"}),await n.A.delete(`http://localhost:6060/news/history/clear?phone=${this.phone}`),this.$toast.success("已清空"),this.listData=[],this.historyCount=0}catch(t){"cancel"!==t&&(console.error("Clear history error:",t),this.$toast.fail("清空失败"))}},clearCache(){this.$dialog.confirm({title:"提示",message:"确定要清除缓存吗？"}).then(()=>{localStorage.clear(),this.$toast.success("缓存已清除")}).catch(()=>{})}},beforeDestroy(){this.countdownTimer&&clearInterval(this.countdownTimer)}},l=a,r=o(1656),c=(0,r.A)(l,s,i,!1,null,"4668a732",null),h=c.exports}}]);
//# sourceMappingURL=997.83e22e81.js.map