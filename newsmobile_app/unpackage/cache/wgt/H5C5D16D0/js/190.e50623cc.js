"use strict";(self["webpackChunknewsmobile"]=self["webpackChunknewsmobile"]||[]).push([[190],{2190:function(t,e,s){s.r(e),s.d(e,{default:function(){return h}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"detail-container"},[e("van-nav-bar",{staticClass:"nav-header",attrs:{title:"新闻详情","left-arrow":""},on:{"click-left":t.goBack}}),t.loading?e("van-loading",{staticClass:"loading-center",attrs:{size:"36px",vertical:""}},[t._v(" 加载中... ")]):e("div",{staticClass:"news-content-wrapper"},[e("h1",{staticClass:"news-title"},[t._v(t._s(t.news.ntitle))]),e("div",{staticClass:"news-meta"},[e("span",{staticClass:"meta-author"},[e("van-icon",{attrs:{name:"user-o"}}),t._v(" "+t._s(t.news.author||"未知来源")+" ")],1),e("span",{staticClass:"meta-date"},[e("van-icon",{attrs:{name:"clock-o"}}),t._v(" "+t._s(t.news.createdate)+" ")],1)]),e("div",{staticClass:"news-body",domProps:{innerHTML:t._s(t.news.content||"暂无内容")}}),e("div",{staticClass:"action-bar"},[e("div",{staticClass:"action-item",class:{active:t.isLiked},on:{click:t.handleLike}},[e("van-icon",{attrs:{name:t.isLiked?"good-job":"good-job-o"}}),e("span",[t._v(t._s(t.isLiked?"已点赞":"点赞"))])],1),e("div",{staticClass:"action-item",class:{active:t.isCollected},on:{click:t.handleCollect}},[e("van-icon",{attrs:{name:t.isCollected?"star":"star-o"}}),e("span",[t._v(t._s(t.isCollected?"已收藏":"收藏"))])],1),e("div",{staticClass:"action-item",on:{click:t.scrollToComment}},[e("van-icon",{attrs:{name:"comment-o"}}),e("span",[t._v("评论")])],1)]),e("van-divider",[t._v("评论区")]),e("div",{staticClass:"comment-input-section"},[e("van-field",{staticClass:"comment-input",attrs:{rows:"3",autosize:"",type:"textarea",placeholder:"说点什么吧..."},model:{value:t.commentContent,callback:function(e){t.commentContent=e},expression:"commentContent"}}),e("div",{staticClass:"comment-options"},[e("van-checkbox",{attrs:{shape:"square"},model:{value:t.isAnonymous,callback:function(e){t.isAnonymous=e},expression:"isAnonymous"}},[t._v("匿名评论")]),e("van-button",{attrs:{type:"primary",size:"small",round:""},on:{click:t.submitComment}},[t._v(" 发表评论 ")])],1)],1),e("div",{ref:"commentSection",staticClass:"comment-list"},[0===t.comments.length?e("div",{staticClass:"no-comment"},[e("van-empty",{attrs:{image:"search",description:"暂无评论，快来抢沙发吧~"}})],1):t._e(),t._l(t.comments,function(s){return e("div",{key:s.cid,staticClass:"comment-item"},[e("div",{staticClass:"comment-header"},[e("span",{staticClass:"comment-user"},[t._v(t._s(s.username||"匿名用户"))]),0===s.status?e("span",{staticClass:"pending-tag"},[t._v("待审核")]):t._e()]),e("div",{staticClass:"comment-text"},[t._v(t._s(s.content))]),e("div",{staticClass:"comment-footer"},[e("span",{staticClass:"comment-time"},[t._v(t._s(s.createdate))]),s.uid===t.currentUid?e("span",{staticClass:"comment-delete",on:{click:function(e){return t.deleteComment(s.cid)}}},[t._v(" 删除 ")]):t._e()])])})],2),e("div",{staticClass:"safe-area-bottom"})],1)],1)},n=[],a=(s(8335),s(4603),s(7566),s(8721),s(4373)),i={name:"NewsDetail",data(){return{loading:!0,news:{},isLiked:!1,isCollected:!1,currentColid:null,currentUid:null,commentContent:"",isAnonymous:!1,comments:[]}},computed:{nid(){return this.$route.params.nid},phone(){return sessionStorage.getItem("cuser")}},mounted(){this.loadNews(),this.phone&&this.getCurrentUser()},methods:{goBack(){this.$router.back()},async getCurrentUser(){try{const t=await a.A.get(`http://localhost:6060/news/users/getbyphone?phone=${this.phone}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),e&&e.uid&&(this.currentUid=e.uid)}catch(t){console.error("Get user error:",t)}},async loadNews(){this.loading=!0;try{const t=await a.A.get(`http://localhost:6060/news/newsinfo/getone?nid=${this.nid}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),e&&e.ntitle&&(this.news=e,this.saveHistory(),this.phone&&(this.checkIfLiked(),this.checkIfCollected()),this.loadComments())}catch(t){console.error("Load news error:",t),this.$toast.fail("加载失败")}finally{this.loading=!1}},async saveHistory(){if(this.phone)try{const t=encodeURIComponent((new Date).toLocaleString());await a.A.post(`http://localhost:6060/news/history/save?phone=${this.phone}&nid=${this.nid}&createdate=${t}`)}catch(t){console.error("Save history error:",t)}},async checkIfLiked(){try{const t=await a.A.get(`http://localhost:6060/news/like/check?phone=${this.phone}&nid=${this.nid}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),this.isLiked=e.liked}catch(t){console.error("Check like error:",t)}},async checkIfCollected(){try{const t=await a.A.get(`http://localhost:6060/news/collection/getdetail?phone=${this.phone}`);let e=t.data;if("string"===typeof e&&(e=JSON.parse(e)),e&&e.length>0)for(let s of e)if(s.nid==this.nid){this.isCollected=!0,this.currentColid=s.colid;break}}catch(t){console.error("Check collect error:",t)}},async handleLike(){if(this.phone)try{const t=await a.A.post(`http://localhost:6060/news/like/toggle?phone=${this.phone}&nid=${this.nid}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),this.isLiked=e.liked,this.$toast(e.liked?"点赞成功":"已取消点赞")}catch(t){console.error("Like error:",t),this.$toast.fail("操作失败")}else this.$toast("请先登录")},async handleCollect(){if(this.phone)if(this.isCollected)try{await a.A.delete(`http://localhost:6060/news/collection/del/${this.currentColid}`),this.isCollected=!1,this.currentColid=null,this.$toast("已取消收藏")}catch(t){console.error("Cancel collect error:",t),this.$toast.fail("取消失败")}else try{const t=new URLSearchParams;t.append("phone",this.phone),t.append("nid",this.nid),t.append("createdate",(new Date).toLocaleString()),await a.A.post("http://localhost:6060/news/collection/save",t),this.isCollected=!0,this.$toast.success("收藏成功"),this.checkIfCollected()}catch(t){console.error("Collect error:",t),this.$toast.fail("收藏失败")}else this.$toast("请先登录")},scrollToComment(){this.$refs.commentSection.scrollIntoView({behavior:"smooth"})},async loadComments(){try{const t=await a.A.get(`http://localhost:6060/news/comment/getbynid?nid=${this.nid}&phone=${this.phone||""}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),this.comments=e||[]}catch(t){console.error("Load comments error:",t)}},async submitComment(){if(this.phone)if(this.commentContent.trim())try{const t=new URLSearchParams;t.append("phone",this.phone),t.append("nid",this.nid),t.append("content",this.commentContent),t.append("createdate",(new Date).toLocaleString()),t.append("anonymous",this.isAnonymous),await a.A.post("http://localhost:6060/news/comment/save",t),this.$toast.success("评论成功"),this.commentContent="",this.isAnonymous=!1,this.loadComments()}catch(t){console.error("Submit comment error:",t),this.$toast.fail("评论失败")}else this.$toast("请输入评论内容");else this.$toast("请先登录")},async deleteComment(t){try{await this.$dialog.confirm({title:"提示",message:"确定要删除这条评论吗？"}),await a.A.delete(`http://localhost:6060/news/comment/del/${t}`),this.$toast.success("删除成功"),this.loadComments()}catch(e){"cancel"!==e&&(console.error("Delete comment error:",e),this.$toast.fail("删除失败"))}}}},c=i,l=s(1656),r=(0,l.A)(c,o,n,!1,null,"2ed3466c",null),h=r.exports}}]);
//# sourceMappingURL=190.e50623cc.js.map