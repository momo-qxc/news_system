"use strict";(self["webpackChunknewsmobile"]=self["webpackChunknewsmobile"]||[]).push([[558],{2558:function(t,e,s){s.r(e),s.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"detail-container"},[e("van-nav-bar",{staticClass:"nav-header",attrs:{title:"新闻详情","left-arrow":""},on:{"click-left":t.goBack}}),t.loading?e("van-loading",{staticClass:"loading-center",attrs:{size:"36px",vertical:""}},[t._v(" 加载中... ")]):e("div",{staticClass:"news-content-wrapper"},[e("h1",{staticClass:"news-title"},[t._v(t._s(t.news.ntitle))]),e("div",{staticClass:"news-meta"},[e("span",{staticClass:"meta-author"},[e("van-icon",{attrs:{name:"user-o"}}),t._v(" "+t._s(t.news.author||"未知来源")+" ")],1),e("span",{staticClass:"meta-date"},[e("van-icon",{attrs:{name:"clock-o"}}),t._v(" "+t._s(t.news.createdate)+" ")],1)]),e("div",{staticClass:"news-body",domProps:{innerHTML:t._s(t.news.content||"暂无内容")}}),e("div",{staticClass:"action-bar"},[e("div",{staticClass:"action-item",class:{active:t.isLiked,liked:t.isLiked},on:{click:t.handleLike}},[e("van-icon",{attrs:{name:t.isLiked?"good-job":"good-job-o",color:t.isLiked?"#e60012":"#646566"}}),e("span",[t._v(t._s(t.isLiked?"已点赞":"点赞"))])],1),e("div",{staticClass:"action-item",class:{active:t.isCollected,collected:t.isCollected},on:{click:t.handleCollect}},[e("van-icon",{attrs:{name:t.isCollected?"star":"star-o",color:t.isCollected?"#faad14":"#646566"}}),e("span",[t._v(t._s(t.isCollected?"已收藏":"收藏"))])],1),e("div",{staticClass:"action-item",on:{click:t.scrollToComment}},[e("van-icon",{attrs:{name:"comment-o"}}),e("span",[t._v("评论")])],1)]),e("van-divider",[t._v("评论区")]),e("div",{staticClass:"comment-input-section"},[e("van-field",{staticClass:"comment-input",attrs:{rows:"3",autosize:"",type:"textarea",placeholder:"说点什么吧..."},model:{value:t.commentContent,callback:function(e){t.commentContent=e},expression:"commentContent"}}),e("div",{staticClass:"comment-options"},[e("van-checkbox",{attrs:{shape:"square"},model:{value:t.isAnonymous,callback:function(e){t.isAnonymous=e},expression:"isAnonymous"}},[t._v("匿名评论")]),e("van-button",{attrs:{type:"primary",size:"small",round:""},on:{click:t.submitComment}},[t._v(" 发表评论 ")])],1)],1),e("div",{ref:"commentSection",staticClass:"comment-list"},[0===t.comments.length?e("div",{staticClass:"no-comment"},[e("van-empty",{attrs:{image:"search",description:"暂无评论，快来抢沙发吧~"}})],1):t._e(),t._l(t.comments,function(s){return e("div",{key:s.cid,staticClass:"comment-item"},[e("div",{staticClass:"comment-main"},[e("div",{staticClass:"comment-header"},[e("span",{staticClass:"comment-user"},[t._v(t._s(s.username||"匿名用户"))]),0===s.status?e("span",{staticClass:"pending-tag"},[t._v("待审核")]):t._e()]),e("div",{staticClass:"comment-text"},[t._v(t._s(s.content))]),e("div",{staticClass:"comment-footer"},[e("div",{staticClass:"footer-left"},[e("span",{staticClass:"comment-time"},[t._v(t._s(s.createdate))]),s.uid===t.currentUid?e("span",{staticClass:"comment-delete",on:{click:function(e){return e.stopPropagation(),t.deleteComment(s.cid)}}},[t._v(" 删除 ")]):t._e()]),e("div",{staticClass:"footer-right"},[e("div",{staticClass:"interaction-item",on:{click:function(e){return e.stopPropagation(),t.toggleCommentLike(s)}}},[e("van-icon",{attrs:{name:s.isLiked?"like":"like-o",color:s.isLiked?"#e60012":"#969799"}}),e("span",[t._v(t._s(s.likeCount||0))])],1),e("div",{staticClass:"interaction-item",on:{click:function(e){return e.stopPropagation(),t.prepareReply(s)}}},[e("van-icon",{attrs:{name:"comment-o"}}),e("span",[t._v("回复")])],1)])])]),s.replyList&&s.replyList.length>0?e("div",{staticClass:"reply-list"},t._l(s.replyList,function(s){return e("div",{key:s.cid,staticClass:"reply-item"},[e("div",{staticClass:"reply-header"},[e("span",{staticClass:"reply-user"},[t._v(t._s(s.username||"匿名用户"))]),0===s.status?e("span",{staticClass:"pending-tag"},[t._v("待审核")]):t._e()]),e("div",{staticClass:"reply-text"},[t._v(t._s(s.content))]),e("div",{staticClass:"reply-footer"},[e("span",{staticClass:"comment-time"},[t._v(t._s(s.createdate))]),e("div",{staticClass:"interaction-item",on:{click:function(e){return e.stopPropagation(),t.toggleCommentLike(s)}}},[e("van-icon",{attrs:{name:s.isLiked?"like":"like-o",color:s.isLiked?"#e60012":"#969799"}}),e("span",[t._v(t._s(s.likeCount||0))])],1)])])}),0):t._e()])})],2),e("div",{staticClass:"safe-area-bottom"})],1)],1)},n=[],o=(s(8335),s(4603),s(7566),s(8721),s(4373)),a=s(2674),c={name:"NewsDetail",data(){return{loading:!0,news:{},isLiked:!1,isCollected:!1,currentColid:null,currentUid:null,commentContent:"",isAnonymous:!1,replyTo:null,comments:[]}},computed:{nid(){return this.$route.params.nid},phone(){return sessionStorage.getItem("cuser")}},mounted(){this.loadNews(),this.phone&&this.getCurrentUser()},methods:{goBack(){this.$router.back()},async getCurrentUser(){try{const t=await o.A.get(`${a.A}/news/users/getbyphone?phone=${this.phone}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),e&&e.uid&&(this.currentUid=e.uid)}catch(t){console.error("Get user error:",t)}},async loadNews(){this.loading=!0;try{const t=await o.A.get(`${a.A}/news/newsinfo/getone?nid=${this.nid}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),e&&e.ntitle&&(this.news=e,this.saveHistory(),this.phone&&(this.checkIfLiked(),this.checkIfCollected()),this.loadComments())}catch(t){console.error("Load news error:",t),this.$toast.fail("加载失败")}finally{this.loading=!1}},async saveHistory(){if(this.phone)try{const t=encodeURIComponent((new Date).toLocaleString());await o.A.post(`${a.A}/news/history/save?phone=${this.phone}&nid=${this.nid}&createdate=${t}`)}catch(t){console.error("Save history error:",t)}},async checkIfLiked(){try{const t=await o.A.get(`${a.A}/news/like/check?phone=${this.phone}&nid=${this.nid}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),this.isLiked=e.liked}catch(t){console.error("Check like error:",t)}},async checkIfCollected(){try{const t=await o.A.get(`${a.A}/news/collection/getdetail?phone=${this.phone}`);let e=t.data;if("string"===typeof e&&(e=JSON.parse(e)),e&&e.length>0)for(let s of e)if(s.nid==this.nid){this.isCollected=!0,this.currentColid=s.colid;break}}catch(t){console.error("Check collect error:",t)}},async handleLike(){if(this.phone)try{const t=await o.A.post(`${a.A}/news/like/toggle?phone=${this.phone}&nid=${this.nid}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),this.isLiked=e.liked,this.$toast(e.liked?"点赞成功":"已取消点赞")}catch(t){console.error("Like error:",t),this.$toast.fail("操作失败")}else this.$toast("请先登录")},async handleCollect(){if(this.phone)if(this.isCollected)try{await o.A.delete(`${a.A}/news/collection/del/${this.currentColid}`),this.isCollected=!1,this.currentColid=null,this.$toast("已取消收藏")}catch(t){console.error("Cancel collect error:",t),this.$toast.fail("取消失败")}else try{const t=new URLSearchParams;t.append("phone",this.phone),t.append("nid",this.nid),t.append("createdate",(new Date).toLocaleString()),await o.A.post(`${a.A}/news/collection/save`,t),this.isCollected=!0,this.$toast.success("收藏成功"),this.checkIfCollected()}catch(t){console.error("Collect error:",t),this.$toast.fail("收藏失败")}else this.$toast("请先登录")},scrollToComment(){this.$refs.commentSection.scrollIntoView({behavior:"smooth"})},async loadComments(){try{const t=await o.A.get(`${a.A}/news/comment/getbynid?nid=${this.nid}&phone=${this.phone||""}`);let e=t.data;"string"===typeof e&&(e=JSON.parse(e)),this.comments=e||[]}catch(t){console.error("Load comments error:",t)}},async submitComment(){if(this.phone)if(this.commentContent.trim())try{const t=new URLSearchParams;t.append("phone",this.phone),t.append("nid",this.nid),t.append("content",this.commentContent),t.append("createdate",(new Date).toLocaleString()),t.append("anonymous",this.isAnonymous),this.replyTo&&t.append("pid",this.replyTo.cid);const e=await o.A.post(`${a.A}/news/comment/save`,t);let s=e.data;if("string"===typeof s&&(s=JSON.parse(s)),s&&!1===s.success)return void this.$toast.fail(s.message||"评论包含违禁词");this.$toast.success(this.replyTo?"回复成功":"评论成功"),this.commentContent="",this.isAnonymous=!1,this.replyTo=null,this.loadComments()}catch(t){console.error("Submit comment error:",t),this.$toast.fail("操作失败")}else this.$toast("请输入评论内容");else this.$toast("请先登录")},prepareReply(t){this.phone?(this.replyTo=t,this.commentContent=`@${t.username||"匿名用户"} `,this.scrollToComment()):this.$toast("请先登录")},async toggleCommentLike(t){if(this.phone)try{const e=t.isLiked?"/news/comment/unlike":"/news/comment/like";await o.A.post(`${a.A}${e}?cid=${t.cid}&phone=${this.phone}`),t.isLiked=!t.isLiked,t.likeCount=(t.likeCount||0)+(t.isLiked?1:-1)}catch(e){console.error("Toggle comment like error:",e)}else this.$toast("请先登录")},async deleteComment(t){try{await this.$dialog.confirm({title:"提示",message:"确定要删除这条评论吗？"}),await o.A.delete(`${a.A}/news/comment/del/${t}`),this.$toast.success("删除成功"),this.loadComments()}catch(e){"cancel"!==e&&(console.error("Delete comment error:",e),this.$toast.fail("删除失败"))}}}},l=c,r=s(1656),d=(0,r.A)(l,i,n,!1,null,"69f64662",null),m=d.exports}}]);
//# sourceMappingURL=558.624929a7.js.map