{"version":3,"file":"js/961.d20a7f15.js","mappings":"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","sources":["webpack://newsmobile/./src/views/TrafficView.vue","webpack://newsmobile/src/views/TrafficView.vue","webpack://newsmobile/./src/views/TrafficView.vue?1154","webpack://newsmobile/./src/views/TrafficView.vue?b7f1"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"traffic-container\"},[_c('div',{staticClass:\"header\"},[_c('van-nav-bar',{staticClass:\"nav-header\",attrs:{\"title\":\"地铁线路图\"},scopedSlots:_vm._u([{key:\"right\",fn:function(){return [_c('div',{staticClass:\"city-selector\",on:{\"click\":function($event){_vm.showCityPicker = true}}},[_c('span',[_vm._v(_vm._s(_vm.currentCity))]),_c('van-icon',{attrs:{\"name\":\"arrow-down\",\"size\":\"12\"}})],1)]},proxy:true}])})],1),_c('div',{staticClass:\"subway-container\",attrs:{\"id\":\"subway-container\"}}),_c('van-popup',{attrs:{\"position\":\"bottom\",\"round\":\"\"},model:{value:(_vm.showCityPicker),callback:function ($$v) {_vm.showCityPicker=$$v},expression:\"showCityPicker\"}},[_c('van-picker',{attrs:{\"show-toolbar\":\"\",\"title\":\"选择城市\",\"columns\":_vm.subwayCities,\"value-key\":\"name\"},on:{\"confirm\":_vm.onCityConfirm,\"cancel\":function($event){_vm.showCityPicker = false}}})],1),_c('van-tabbar',{attrs:{\"active-color\":\"#e60012\",\"route\":\"\"},model:{value:(_vm.active),callback:function ($$v) {_vm.active=$$v},expression:\"active\"}},[_c('van-tabbar-item',{attrs:{\"icon\":\"home-o\",\"to\":\"/\"}},[_vm._v(\"首页\")]),_c('van-tabbar-item',{attrs:{\"icon\":\"location-o\",\"to\":\"/life\"}},[_vm._v(\"生活\")]),_c('van-tabbar-item',{attrs:{\"icon\":\"guide-o\",\"to\":\"/traffic\"}},[_vm._v(\"交通\")]),_c('van-tabbar-item',{attrs:{\"icon\":\"user-o\",\"to\":\"/my\"}},[_vm._v(\"我的\")])],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"traffic-container\">\n    <!-- 顶部导航栏 -->\n    <div class=\"header\">\n      <van-nav-bar title=\"地铁线路图\" class=\"nav-header\">\n        <template #right>\n          <div class=\"city-selector\" @click=\"showCityPicker = true\">\n            <span>{{ currentCity }}</span>\n            <van-icon name=\"arrow-down\" size=\"12\" />\n          </div>\n        </template>\n      </van-nav-bar>\n    </div>\n\n    <!-- 地铁图容器 -->\n    <div id=\"subway-container\" class=\"subway-container\"></div>\n\n    <!-- 城市选择器 -->\n    <van-popup v-model=\"showCityPicker\" position=\"bottom\" round>\n      <van-picker\n        show-toolbar\n        title=\"选择城市\"\n        :columns=\"subwayCities\"\n        value-key=\"name\"\n        @confirm=\"onCityConfirm\"\n        @cancel=\"showCityPicker = false\"\n      />\n    </van-popup>\n\n    <!-- 底部导航 -->\n    <van-tabbar v-model=\"active\" active-color=\"#e60012\" route>\n      <van-tabbar-item icon=\"home-o\" to=\"/\">首页</van-tabbar-item>\n      <van-tabbar-item icon=\"location-o\" to=\"/life\">生活</van-tabbar-item>\n      <van-tabbar-item icon=\"guide-o\" to=\"/traffic\">交通</van-tabbar-item>\n      <van-tabbar-item icon=\"user-o\" to=\"/my\">我的</van-tabbar-item>\n    </van-tabbar>\n  </div>\n</template>\n\n<script>\n/* global BMapSub, BMapGL */\n\nexport default {\n  name: 'TrafficView',\n  data() {\n    return {\n      active: 2,\n      currentCity: '厦门',\n      currentCityCode: '',\n      showCityPicker: false,\n      subway: null,\n      subwayCities: []\n    }\n  },\n  mounted() {\n    this.initSubwayCities()\n    this.$nextTick(() => {\n      this.autoSelectCityByLocation()\n    })\n  },\n  methods: {\n    // 初始化支持地铁的城市列表\n    initSubwayCities() {\n      if (typeof BMapSub !== 'undefined' && BMapSub.SubwayCitiesList) {\n        this.subwayCities = BMapSub.SubwayCitiesList\n        // 找到默认城市\n        const defaultCity = this.subwayCities.find(c => c.name === this.currentCity)\n        if (defaultCity) {\n          this.currentCityCode = defaultCity.citycode\n        }\n      }\n    },\n\n    // 根据定位自动选择城市\n    autoSelectCityByLocation() {\n      if (typeof BMapGL !== 'undefined') {\n        const geolocation = new BMapGL.Geolocation()\n        geolocation.getCurrentPosition((result) => {\n          if (geolocation.getStatus() === 0 && result.address && result.address.city) {\n            // 获取定位城市名称（去掉\"市\"后缀）\n            let cityName = result.address.city.replace('市', '')\n            \n            // 查找是否有该城市的地铁\n            let matchedCity = this.subwayCities.find(c => c.name === cityName)\n            \n            // 如果没有精确匹配，尝试模糊匹配\n            if (!matchedCity) {\n              matchedCity = this.subwayCities.find(c => \n                c.name.includes(cityName) || cityName.includes(c.name)\n              )\n            }\n            \n            if (matchedCity) {\n              this.currentCity = matchedCity.name\n              this.currentCityCode = matchedCity.citycode\n            }\n            // 无论是否匹配到城市，都初始化地铁图\n            this.initSubway()\n          } else {\n            // 定位失败，使用默认城市\n            this.initSubway()\n          }\n        }, { enableHighAccuracy: true, timeout: 5000 })\n      } else {\n        // 百度地图未加载，使用默认城市\n        this.initSubway()\n      }\n    },\n\n    // 初始化地铁图\n    initSubway() {\n      if (!this.currentCityCode) {\n        const city = this.subwayCities.find(c => c.name === this.currentCity)\n        if (city) {\n          this.currentCityCode = city.citycode\n        } else if (this.subwayCities.length > 0) {\n          this.currentCity = this.subwayCities[0].name\n          this.currentCityCode = this.subwayCities[0].citycode\n        }\n      }\n\n      if (this.currentCityCode) {\n        this.subway = new BMapSub.Subway('subway-container', this.currentCityCode)\n        this.subway.setZoom(0.4)\n      }\n    },\n\n    // 选择城市\n    onCityConfirm(value) {\n      this.currentCity = value.name\n      this.currentCityCode = value.citycode\n      this.showCityPicker = false\n      \n      // 重新初始化地铁图\n      this.$nextTick(() => {\n        this.initSubway()\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.traffic-container {\n  min-height: 100vh;\n  background: #f7f8fa;\n  display: flex;\n  flex-direction: column;\n  padding-bottom: 50px;\n}\n\n/* 导航栏 */\n.nav-header {\n  background: linear-gradient(135deg, #e60012 0%, #ff4d4f 100%) !important;\n}\n.nav-header ::v-deep .van-nav-bar__title {\n  color: #fff !important;\n  font-weight: bold;\n}\n\n/* 城市选择器 */\n.city-selector {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  padding: 6px 12px;\n  background: rgba(255, 255, 255, 0.2);\n  border-radius: 20px;\n  font-size: 14px;\n  color: #fff;\n  white-space: nowrap;\n}\n\n.city-selector:active {\n  background: rgba(255, 255, 255, 0.3);\n}\n\n/* 地铁图容器 */\n.subway-container {\n  flex: 1;\n  min-height: calc(100vh - 100px);\n  background: #fff;\n}\n</style>","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./TrafficView.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./TrafficView.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./TrafficView.vue?vue&type=template&id=8855f9fa&scoped=true\"\nimport script from \"./TrafficView.vue?vue&type=script&lang=js\"\nexport * from \"./TrafficView.vue?vue&type=script&lang=js\"\nimport style0 from \"./TrafficView.vue?vue&type=style&index=0&id=8855f9fa&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"8855f9fa\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","scopedSlots","_u","key","fn","on","$event","showCityPicker","_v","_s","currentCity","proxy","model","value","callback","$$v","expression","subwayCities","onCityConfirm","active","staticRenderFns","name","data","currentCityCode","subway","mounted","initSubwayCities","$nextTick","autoSelectCityByLocation","methods","BMapSub","SubwayCitiesList","defaultCity","find","c","citycode","BMapGL","geolocation","Geolocation","getCurrentPosition","result","getStatus","address","city","cityName","replace","matchedCity","includes","initSubway","enableHighAccuracy","timeout","length","Subway","setZoom","component"],"ignoreList":[],"sourceRoot":""}