"use strict";(self["webpackChunknewsmobile"]=self["webpackChunknewsmobile"]||[]).push([[154],{1154:function(t,e,a){a.r(e),a.d(e,{default:function(){return l}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"life-container"},[e("van-nav-bar",{staticClass:"nav-header",attrs:{title:"生活地图"},scopedSlots:t._u([{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"search",size:"18"},on:{click:function(e){t.showSearch=!0}}})]},proxy:!0}])}),e("div",{ref:"mapContainer",attrs:{id:"map-container"}}),e("div",{staticClass:"location-btn",on:{click:t.locateMe}},[e("van-icon",{attrs:{name:"aim"}})],1),t.currentAddress?e("div",{staticClass:"location-card"},[e("div",{staticClass:"card-header"},[e("van-icon",{staticClass:"location-icon",attrs:{name:"location-o"}}),e("span",{staticClass:"card-title"},[t._v("当前位置")])],1),e("div",{staticClass:"card-content"},[t._v(t._s(t.currentAddress))]),e("div",{staticClass:"card-actions"},[e("van-button",{attrs:{size:"small",round:"",type:"primary"},on:{click:function(e){return t.searchNearby("餐饮")}}},[e("van-icon",{attrs:{name:"shop-o"}}),t._v(" 美食 ")],1),e("van-button",{attrs:{size:"small",round:"",type:"info"},on:{click:function(e){return t.searchNearby("酒店")}}},[e("van-icon",{attrs:{name:"hotel-o"}}),t._v(" 酒店 ")],1),e("van-button",{attrs:{size:"small",round:"",type:"success"},on:{click:function(e){return t.searchNearby("景点")}}},[e("van-icon",{attrs:{name:"photo-o"}}),t._v(" 景点 ")],1)],1)]):t._e(),e("van-popup",{style:{height:"100%"},attrs:{position:"top"},model:{value:t.showSearch,callback:function(e){t.showSearch=e},expression:"showSearch"}},[e("div",{staticClass:"search-panel"},[e("van-search",{attrs:{"show-action":"",placeholder:"搜索地点"},on:{search:t.onSearch,cancel:function(e){t.showSearch=!1}},model:{value:t.searchKeyword,callback:function(e){t.searchKeyword=e},expression:"searchKeyword"}}),t.searchResults.length>0?e("div",{staticClass:"search-results"},t._l(t.searchResults,function(a,s){return e("van-cell",{key:s,attrs:{title:a.title,label:a.address,"is-link":""},on:{click:function(e){return t.goToLocation(a)}}})}),1):t.searchKeyword&&!t.searching?e("van-empty",{attrs:{description:"暂无搜索结果"}}):t._e()],1)]),e("van-action-sheet",{attrs:{title:t.nearbyTitle},model:{value:t.showNearby,callback:function(e){t.showNearby=e},expression:"showNearby"}},[e("div",{staticClass:"nearby-list"},[t._l(t.nearbyResults,function(a,s){return e("van-cell",{key:s,attrs:{title:a.title,label:a.address,"is-link":""},on:{click:function(e){return t.goToLocation(a)}},scopedSlots:t._u([{key:"right-icon",fn:function(){return[e("span",{staticClass:"distance"},[t._v(t._s(a.distance))])]},proxy:!0}],null,!0)})}),0===t.nearbyResults.length?e("van-empty",{attrs:{description:"附近暂无相关地点"}}):t._e()],2)]),e("van-tabbar",{attrs:{"active-color":"#e60012",route:""},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[e("van-tabbar-item",{attrs:{icon:"home-o",to:"/"}},[t._v("首页")]),e("van-tabbar-item",{attrs:{icon:"location-o",to:"/life"}},[t._v("生活")]),e("van-tabbar-item",{attrs:{icon:"guide-o",to:"/traffic"}},[t._v("交通")]),e("van-tabbar-item",{attrs:{icon:"user-o",to:"/my"}},[t._v("我的")])],1)],1)},n=[],i=(a(4114),a(8111),a(1701),{name:"LifeView",data(){return{active:1,map:null,currentAddress:"",currentPoint:null,showSearch:!1,searchKeyword:"",searchResults:[],searching:!1,showNearby:!1,nearbyTitle:"",nearbyResults:[],geolocation:null,localSearch:null}},mounted(){this.initMap()},beforeDestroy(){this.map&&(this.map=null)},methods:{initMap(){if("undefined"===typeof BMapGL)return console.error("百度地图 API 未加载"),void this.$toast.fail("地图加载失败");this.map=new BMapGL.Map(this.$refs.mapContainer);const t=new BMapGL.Point(116.404,39.915);this.map.centerAndZoom(t,15),this.map.enableScrollWheelZoom(!0);const e=new BMapGL.ScaleControl;this.map.addControl(e),this.geolocation=new BMapGL.Geolocation,this.localSearch=new BMapGL.LocalSearch(this.map,{renderOptions:{map:this.map}}),this.locateMe()},locateMe(){this.geolocation?(this.$toast.loading({message:"定位中...",forbidClick:!0}),this.geolocation.getCurrentPosition(t=>{if(this.$toast.clear(),0===this.geolocation.getStatus()){this.currentPoint=t.point;const e=t.address;this.currentAddress=[e.province,e.city,e.district,e.street,e.streetNumber].filter(t=>t&&"undefined"!==t).join(""),this.map.centerAndZoom(t.point,16),this.map.clearOverlays();const a=new BMapGL.Marker(t.point);this.map.addOverlay(a);const s=new BMapGL.Circle(t.point,t.accuracy,{strokeColor:"#e60012",strokeWeight:2,strokeOpacity:.5,fillColor:"#e60012",fillOpacity:.1});this.map.addOverlay(s),this.$toast.success("定位成功")}else this.$toast.fail("定位失败，请检查权限")},{enableHighAccuracy:!0,timeout:1e4})):this.$toast.fail("定位服务未初始化")},onSearch(){this.searchKeyword.trim()&&(this.searching=!0,this.searchResults=[],this.localSearch.setSearchCompleteCallback(t=>{if(this.searching=!1,t&&t.getCurrentNumPois()>0){const e=[];for(let a=0;a<t.getCurrentNumPois();a++){const s=t.getPoi(a);e.push({title:s.title,address:s.address,point:s.point})}this.searchResults=e}}),this.localSearch.search(this.searchKeyword))},searchNearby(t){if(!this.currentPoint)return void this.$toast("请先定位");this.nearbyTitle=`附近的${t}`,this.nearbyResults=[],this.showNearby=!0;const e=new BMapGL.LocalSearch(this.map,{renderOptions:{map:this.map},onSearchComplete:t=>{if(t&&t.getCurrentNumPois()>0){const e=[];for(let a=0;a<t.getCurrentNumPois();a++){const s=t.getPoi(a),n=this.map.getDistance(this.currentPoint,s.point);e.push({title:s.title,address:s.address,point:s.point,distance:n<1e3?`${Math.round(n)}m`:`${(n/1e3).toFixed(1)}km`})}this.nearbyResults=e}}});e.searchNearby(t,this.currentPoint,2e3)},goToLocation(t){this.showSearch=!1,this.showNearby=!1,this.map.clearOverlays(),this.map.centerAndZoom(t.point,17);const e=new BMapGL.Marker(t.point);this.map.addOverlay(e);const a=new BMapGL.InfoWindow(t.title,{width:200,title:t.title});e.addEventListener("click",()=>{this.map.openInfoWindow(a,t.point)}),setTimeout(()=>{this.map.openInfoWindow(a,t.point)},300)}}}),o=i,r=a(1656),c=(0,r.A)(o,s,n,!1,null,"7d84d41e",null),l=c.exports}}]);
//# sourceMappingURL=154.932b46bf.js.map